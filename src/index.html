<!doctype html>

<html lang="en">

<head>
  <!-- https://www.w3schools.com/html/html_css.asp -->
  <link rel="stylesheet" href="someclass.css">
  <meta charset="utf-8">
  <script src="https://cdn.jsdelivr.net/pyodide/v0.17.0/full/pyodide.js"></script>
  <script>
    const setup_pyodide = () => {
      const setup_code = `
    import sys, io, traceback
    
    namespace = {}  # use separate namespace to hide run_code, modules, etc.
    def run_code(code):
      """run specified code and return stdout and stderr"""
      out, err = io.StringIO(), io.StringIO()
      oldout, olderr = sys.stdout, sys.stderr
      sys.stdout, sys.stderr = out, err
      try:
        # change next line to exec(code, {}) if you want to clear vars each time
        exec(code, namespace)
      except:
        traceback.print_exc()
      
      sys.stdout = oldout
      sys.stderr = olderr
      return [out.getvalue(), err.getvalue()]
    `;
      pyodide.runPython(setup_code);
    }
    const pyodide_log = (...args) => {
      const output = document.getElementById('pyodide_code_output');
      output.value = `${output.value}${args.join('')}\n`;
    }
    (async () => {
      loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.17.0/full/" }).then(() => {
        setup_pyodide();
      });
    })();
    
    async function run_python_code() {
      const code_input = document.getElementById('codespace').value;
      pyodide.globals.set('PYODIDE_CODE_INPUT', code_input);
      await pyodide.loadPackagesFromImports(code_input);
      const [output, error] = pyodide.runPython(`run_code(PYODIDE_CODE_INPUT)`);
      document.getElementById('program_output').value += `stdout: ${output}\nstderr: ${error}\n`;
    };
  </script>

  <!--application functions-->
  <script>
    async function pyfunc() {
      var pycode;
        var edited_pythoncode;
        var stdout;


      pycode = document.getElementById("codespace").value;
      await pyodide.runPythonAsync(document.getElementById("codespace").value, console.log)

      for (var i = 0; i < stdout.length; i++) {
        document.getElementById("program_output").value += stdout[i];
      }
    };
  </script>

</head>

<body>
  <h1>Python Code</h1>
  <textarea cols="80" rows="10" id="codespace"></textarea>
  <input type="button" id="run_code" onclick="run_python_code()" value="Run!">
  <br>
  <h2>Program Output</h2>
  <textarea cols="80" rows="15" id="program_output"></textarea>
</body>